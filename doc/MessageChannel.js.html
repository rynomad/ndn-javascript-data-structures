<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Transports/browser/MessageChannel.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Transports/browser/MessageChannel.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>var ElementReader = require("ndn-lib/js/encoding/element-reader.js").ElementReader;
var Transport = require("ndn-lib/js/transport/transport.js").Transport;
var debug = {};
debug.debug = require("debug")("MessageChannelTransport");


/**Transport Class for HTML5 MessageChannels
 *@constructor
 *@param {MessageChannel_Port} port one end of an HTML MessageChannel
 *@returns {MessageChannelTransport}
 */
function MessageChannelTransport (port) {
  debug.debug("constructor");
  Transport.call(this);
  this.connectionInfo = new MessageChannelTransport.ConnectionInfo(port);
  return this;
}


MessageChannelTransport.prototype = new Transport();
MessageChannelTransport.prototype.name = "MessageChannelTransport";

MessageChannelTransport.ConnectionInfo = function MessageChannelTransportConnectionInfo(port){
  Transport.ConnectionInfo.call(this);
  this.port = port;
};

MessageChannelTransport.ConnectionInfo.prototype = new Transport.ConnectionInfo();
MessageChannelTransport.ConnectionInfo.prototype.name = "MessageChannelTransport.ConnectionInfo";

MessageChannelTransport.ConnectionInfo.prototype.getPort = function()
{
  return this.port;
};

MessageChannelTransport.ConnectionInfo.prototype.equals = function(other)
{
  if (other === null || other.port === undefined){
    return false;
  }
  return (this.port === other.port);
};

/**Set the event listener for incoming elements
 *@param {Object} face the ndn.Face object that this transport is attached to
 *@param {function} onopenCallback a callback to be performed once the transport is open
 */
MessageChannelTransport.prototype.connect = function(connectionInfo, elementListener, onopenCallback, onclosedCallback)
{
  debug.debug("connect");
  this.elementReader = new ElementReader(elementListener);
  var self = this;
  connectionInfo.getPort().onmessage = function(ev) {
    debug.debug("onmessage called");
    if (ev.data.buffer instanceof ArrayBuffer) {
      try {
        self.elementReader.onReceivedData(new Buffer(ev.data));
      } catch (ex) {
        debug.debug(" onmessage exception: %s", ex);
        return;
      }
    }
  };
  //elementListener.readyStatus = 2
  onopenCallback();
};

/**Send the Uint8Array data.
 *@param {Buffer} element the data packet
 */
MessageChannelTransport.prototype.send = function(element)
{
  debug.debug("send");
  this.connectionInfo.getPort().postMessage(element);
};

module.exports = MessageChannelTransport;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="ContentStore.html">ContentStore</a></li><li><a href="ContentStore_insert.html">insert</a></li><li><a href="csEntry.html">csEntry</a></li><li><a href="DataChannelTransport.html">DataChannelTransport</a></li><li><a href="FIB.html">FIB</a></li><li><a href="FibEntry.html">FibEntry</a></li><li><a href="Interfaces.html">Interfaces</a></li><li><a href="MessageChannelTransport.html">MessageChannelTransport</a></li><li><a href="NameTree.html">NameTree</a></li><li><a href="NameTreeNode.html">NameTreeNode</a></li><li><a href="PIT.html">PIT</a></li><li><a href="PitEntry.html">PitEntry</a></li><li><a href="Transport.html">Transport</a></li><li><a href="WebSocketServerTransport.html">WebSocketServerTransport</a></li></ul><h3>Global</h3><ul><li><a href="global.html#compareArrays">compareArrays</a></li><li><a href="global.html#ElementReader">ElementReader</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Nov 14 2014 00:53:33 GMT-0700 (MST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
